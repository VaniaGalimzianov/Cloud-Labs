## Лабораторная работа №2. Docker
Цель второй лабораторной работы - ознакомление с принципами написания `Dockerfile`. Будут рассмотрены плохие практики написания файла, а затем они будут исправлены. Кроме того, будут изучены случаи, когда даже правильно написанный `Dockerfile` может привести к проблемам.

### Структура проекта
Для выполнения данной лабораторной работы был создан простой `FastApi` проект:
```bash
/root/itmo/fastapi_project
├── Dockerfile
├── app
│   ├── __init__.py
│   └── app.py
└── requirements.txt
```
Содержимое файла `app/app.py` выглядит следующим образом:
![app.py](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/main.png)

Рисунок 1 - Содержимое файла `app.py`

Далее будут рассмотрены случаи написания Dockerfile и их запуск.

### Плохой Dockerfile
В файле [bad_docker/Dockerfile](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/bad_docker/Dockerfile) приведен пример некорректно написанного файла. Его недостатки заключаются в следующем:
* Отсутствие четкой версии `Python`
* Копирование всех файлов без учета структуры проекта и игнорирования лишних файлов
* Установка зависимостей напрямую без создания виртуального окружения

![bad docker](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/плохой_докер.png)

Рисунок 2 - Некорректный Dockerfile

При запуске данного файла появлялись ошибки, и сборка занимала довольно большое время - 47.8с (рисунок 3).
![bad docker build](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/сборка_плохого_докера.png)

Рисунок 3 - Сборка некорректного Dockerfile

### Исправленный Dockerfile
В файле [good_docker/Dockerfile](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/good_docker/Dockerfile) приведен пример исправленного файла. Его преимущества заключаются в следующем:
* Используется конкретная версия `Python`
* Установлена рабочая директория для лучшей организации файлов
* Копируются только необходимые файлы для установки зависимости
* Устанавливаются зависимости с флагом `--no-cache-dir`, что уменьшает размер образа

![good docker](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/хороший_докер.png)

Рисунок 4 - Исправленный Dockerfile

Запуск данного файла занимает намного меньше времени, не вызывает ошибок и корректно отображает содержимое по адресу `127.0.0.1` (рисунок 5).
![good docker build](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/сборка_хорошего_докера.png)

Рисунок 5 - Сборка исправленного Dockerfile

После сборки контейнер был запущен
![running](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/запуск.png)

Рисунок 6 - Запуск контейнера

![result](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/результат.png)

Рисунок 7 - Отображение содержимого в браузере

### Bad practices по работе с контейнерами
1. **Запуск контейнеров с правами суперпользователя** (`root`)
Эта ошибка ставит под угрозу безопасность системы. Даже если контейнер изолирован, уязвимости в программном обеспечении могут позволить злоумышленнику выйти за пределы контейнера и получить доступ к хостовой системе.

**Проблемы:**
* Уязвимость системы
* Отсутствие изоляции

**Как решить проблему:**
* Запускать контейнеры от имени некорневого пользователя с помощью директивы `USER` или параметра `--user`

2. **Отсутствие мониторинга и управления ресурсами контейнера**
Запуск контейнеров без ограничений на ресурсы может привести к тому, что один контейнер захватит все доступные ресурсы хоста, что повлияет на работу других контейнеров и системы.

**Проблемы:**
* Перегрузка ресурсов хоста
* Отсутствие контроля над производительностью

**Как решить проблему:**
* Использовать флаги `--memory` и `--cpus` при запуске контейнеров для ограничения ресурсов

### Заключение
В лабораторной работе №2 были разобраны такие темы как плохие и хорошие практики написания `Dockerfile`, ситуации даже когда с правильно написанным `Dockerfile` могут возникнуть проблемы и разобраны пути их решения.

Мемчик для поднятия настроения
![Мемчьк](https://github.com/VaniaGalimzianov/Cloud-Labs/blob/main/lab2/docker_mem.webp)
