# Лабораторная работа №3

## Что такое CI/CD?
CI/CD (Continuous Integration, Continuous Delivery — непрерывная интеграция и доставка) - технология, предусмотренная для автоматизации развертывания, в частности процесса тестирования и доставки модулей продукта разработчикам или конечным пользователям. Данная концепция включает в себя целый набор различных методологий и практик. Налаженная система развертывания позволяет значительно ускорить процесс внесения изменений и доставки их пользовател, а также способствует уменьшению числа ошибок и дефектов кода через внедрнение регулярного тестирования. 

### Основные этапы CI/CD
Процесс непрерывной интеграции и доставки включает в себя несколько этапов и может быть представлен в виде замкнутой петли, изображенной на рисунке ниже:

![ci:cd stages](https://github.com/user-attachments/assets/4da59545-1eef-463f-a568-bf029191d9be)
1. Написание кода. Разработчики создают и тестируют собственные модули и затем добавляют их в соответствующую ветку проекта;
2. Сборка. Заранее подобранная система контроля версий запускает автоматизированную сборку и тестирование всего продукта. Триггеры могут быть настроены автоматически или вручную. Автоматическая сборка выполняется с помощью Jenkins или другого сервера непрерывной интеграции.
3. Ручное тестирование. Здесь в дело вступают тестировщики, которые проверяют работу кода на наличие ненайденных уязвимостей;
4. Релиз. Происходит предоставление доступа пользователям к разработанному продукту. Возможно наличие некоторых его уточнений или изменений при возникновении недостатков.
5. Развертывание. Текущая версия программы размещается на серверах разработчика. Заказчик может работать с программой, исследовать ее функции, искать уязвимости.
6. Поддержка и отслеживание. После развертывания приложение становится доступным конечным пользователям. Параллельно этому разработчики выполняют его поддержку и одновременно мониторят реакцию пользователей, анализируют их опыт взаимодействия с программой.
7. Планирование. На основании пользовательского опыта и различных целей формируется план внесения доработок. После этого разработчики вносят все корректировки в продукт — и цикл разработки начинается снова.

### Инструменты реализации CI/CD
В данный момент существует множество инструментов и сервисов, позволяющих осуществлять перечисленные выше процессы. Среди наиболее популярных - GitLab (CI), Jenkins, TeamCity, CircleCI. При выполнении данной лабораторной работы в качестве сервиса для исполнения CI/CD файлов формата `.yaml` использовался сервис GitHub Actions.

## Создание "Плохого" CI/CD файла
Ниже представлен кода CI/CD файла с разработанным CI/CD-pipeline для GitHub Actions, содержащий несколько bad practices, позволяющих его выполнение:
<img width="871" alt="Снимок экрана 2024-10-18 в 20 02 29" src="https://github.com/user-attachments/assets/8e55dfa2-339e-4fad-8db3-7a8b9c305552">
1. **Использование последней версии дистрибутива.** В некоторых случаях использование последней версии операционной системы может привести к возникновению нестабильного поведения, неожиданных изменений и проблем совместитмости при исполнении пайплайна и развертывании;
2. **Клонирование репозитория без указания ветки.** В начале пайплайна в разделе `on:` необходимо указывать название необходимых веток, так как в ином случае необходимые процессы могут запуститься на непредназначенных для этого ветках;
3. **Установка зависимостей без кэша.** Установка зависимостей может являться довольно длительным и тяжелым процессом, поэтому необходимо сохранять установленные зависимости в кэш для сокращения времени работы при каждом запуске workflow;
4. **Ошибки линтера не прерывают сборку.** Линтинг (от англ. “lint”) — это процесс автоматической проверки исходного кода на наличие потенциальных ошибок, нарушений стиля или проблем, которые могут привести к багам или снижению качества кода. Игнорирование ошибок на данном этапе может привести к непрохождению остальных тестов или некорректной работе самого модуля;
5. **Тесты выполняются, но результат игнорируется.** Тестирование не имеет смысла, если его результаты игнорируются, поэтому прерывание исполнения при возникновении ошибок на данном этапе крайне важно;
6. **Выполнение тяжелых задач без распараллеливания.** Некоторые задачи могут исполняться в течении длительного времени, поэтому при построении важно создавать параллельные задачи для несвязанных модулей продукта;
7. **Наличие единственной задачи.** Описываемый CI/CD - пайплайном процесс имеет несколько связанных между собой этапов, представляющих отдельные задачи построения основных элементов, этапы тестирования и деплой, поэтому важно разделять их, устанавливая между ними соответстующие взаимосвязи.

### UPD: Запуск "Плохого" CI/CD файла
После написания CI/CD файла он был помещен в созданную в проекте-примере директорию .github/workflows. Изменения были закоммичены и отправлены в удаленный репозиторий. По исполнению команды `git push` началась работа CI/CD файла. Скрин пайплайна и процесса исполнения команды приведены на рисунках ниже:
<img width="1148" alt="Screenshot 2024-11-20 at 21 02 48" src="https://github.com/user-attachments/assets/d8290541-1b7d-4a3d-99be-2badbaebbe7c">
<img width="1143" alt="Screenshot 2024-11-20 at 21 03 22" src="https://github.com/user-attachments/assets/aeb9401e-64f3-4b83-96fc-5c81943c6e32">


## Создание "Хорошего" CI/CD файла
На рисунке ниже представлен исправленный код CI/CD файла, в котором исключены bad practices, описанные ранее:
<img width="799" alt="Screenshot 2024-11-28 at 23 09 36" src="https://github.com/user-attachments/assets/a2eaa531-01ee-4fc6-9e74-daa275208dd3">
<img width="825" alt="Screenshot 2024-11-28 at 23 09 44" src="https://github.com/user-attachments/assets/fc9816b5-55a6-4526-9c86-a922bf9c6355">
<img width="772" alt="Screenshot 2024-11-28 at 23 10 40" src="https://github.com/user-attachments/assets/26aad33e-d217-4fa4-a379-69f732bce2b8">
1. Вместо использования последней версии дистрибутива зафиксирована конкретная - `ubuntu-20.04`. Теперь пайплайна будет более стабильной и перестанет зависить от совместимостей сервисов с последней версией операционнной системы;
2. В начале файла указаны ветки, для которых выполняется пайплайн. Это исключает возможность непредвиденного исполнения скрипта в непредназначенных для этого ветках;
3. Для загрузки зависимостей теперь используется кэширование с целью уменьшения времени выполнения;
4. Для линтера изменено условие прерывания. Теперь при возникновении ошибок сборка будет прервана;
5. Аналогичное изменение применено и к предварительному тестированию. Прерывание сборки при наличии ошибок и дефектов кода не позволит предоставить конечному пользователю некорректно работающий продукт;
6. Тяжелые задачи, требующие значительного времени и ресурсов для исполнения были разделены и выполняются параллельно. Данное изменение способствует более быстрому исполнению пайплайна;
7. В пайплайн добавлено несколько задач вместо одной единой. Кроме того, добавлены зависимости между задачами, определяющие очередность их выполнения. Описанное исправление позволяет отразить все этапы пайплайнь, упростить понимание его структуры и ускорить работу.

### UPD: Запуск "Хорошего" CI/CD файла
После исправления bad practices в CI/CD файле изменения аналогично были закоммичены и отправлены на удаленный репозиторий. Теперь единая задача разделена на 4 отдельных, каждая из которых подразумевает собственный процесс исполнения в параллельном или последовательном режиме в зависимости от установленных зависимостей. Скрин пайплайна приведен на рисунке ниже:
<img width="1149" alt="Screenshot 2024-11-28 at 23 22 24" src="https://github.com/user-attachments/assets/adff5fd1-0354-4582-bac3-567b0122431a">



## Выводы
По итогам выполнения лабораторной работы были написан "Плохой" и "Хороший" CI/CD файлы и изучены различные bad practices в их написании. Установлено, что отсутствие подобных ошибок позволяет ускорить сборку, исключить некорректное и нестабильное поведение, оптимизировать используемые ресурсы и предоставить конечному пользователю продукт наилучшего качества. 

## Источники
1. https://appcircle.io/blog/bad-ci-cd-practices
2. https://www.reddit.com/r/devsecops/comments/x1ye1o/cicd_bad_practices_best_practices_mistakes/
3. https://habr.com/ru/articles/564548/
